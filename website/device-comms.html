<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Device Comms</title>
    <style>
        body {
            text-align: center;
            padding-top: 50px;
        }
        #counter {
            font-size: 48px;
            font-weight: bold;
            color: #2c3e50;
        }
        .sensor {
            margin-bottom: 20px;
        }
        button {
            margin: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Educational Physics Equipment</h1>
    <p><a href="help.html" target="_blank">Help</a></p>

    <div class="sensor" id="light">
        <h1>Light Sensor:</h1>
        <div id="data-light-serial">No USB device connected...</div>
        <div>
            <button class="button" id="button-light-serial">Select USB Port</button>
        </div>
    </div>

    <div class="sensor" id="rotary">
        <h1>Rotary Encoder:</h1>
        <div id="data-rotary-serial">No USB device connected...</div>
        <div id="data-rotary-BLE">No BLE device connected...</div>
        <div>
            <button class="button" data-pair="button-rotary-BLE" id="button-rotary-serial">Select USB Port</button>
            <button class="button" data-pair="button-rotary-serial" id="button-rotary-BLE">Select Bluetooth Device</button>
        </div>
    </div>

    <div class="sensor" id="ultrasonic">
        <h1>Ultrasonic Sensor:</h1>
        <div id="data-ultrasonic-serial">No USB device connected...</div>
        <div id="data-ultrasonic-BLE">No BLE device connected...</div>
        <div>
            <button class="button" data-pair="button-ultrasonic-BLE" id="button-ultrasonic-serial">Select USB Port</button>
            <button class="button" data-pair="button-ultrasonic-serial" id="button-ultrasonic-BLE">Select Bluetooth Device</button>
        </div>
    </div>

    <hr>

    <h2>Live Sensor Chart</h2>
    <div id="chartContainer">
        <canvas id="sensorChart" width="700" height="350"></canvas>

        <div>
            <button id="startButton">Start Chart</button>
            <button id="stopButton">Stop Chart</button>
            <button id="resetButton">Reset Chart</button>
            <button id="toggleModeButton">Switch to Velocity</button>
            <button id="calculateDelta">Calculate Delta</button>
            <button id="calculateArea">Calculate Area</button>
            <button id="saveCsvButton">Save as data (.csv)</button>
        </div>
        <div id="calculationResult" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <script>
        function focusButton(event) {
            const clickedButton = event.target;
            const pairId = clickedButton.getAttribute('data-pair');
            const pairedButton = pairId ? document.getElementById(pairId) : null;

            if (pairedButton) {
                pairedButton.classList.add('hidden');
            }

            //hide the other sensors
            const currentSensor = clickedButton.closest('.sensor');
            if (currentSensor) {
                document.querySelectorAll('.sensor').forEach(section => {
                    if (section !== currentSensor) {
                        section.classList.add('hidden');
                    }
                });
            } else {
                console.error('Current sensor section not found');
            }
        }

        //event listeners for the buttons
        document.querySelectorAll('.button').forEach(button => {
            button.addEventListener('click', focusButton);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="charting.js"></script>
    <script src="sensor-light.js"></script>
    <script type="module" src="sensor-rotary.js"></script>
    <script src="sensor-ultrasonic.js"></script>
    <script src="device-comms.js"></script>
</body>
</html>