<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Comms</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Educational Physics Equipment</h1>
        <div class="controls">
            <button class="help-button" onclick="window.open('help.html', '_blank')">Help</button>
            <button id="toggleDarkModeButton">Switch to Dark Mode</button>
        </div>

        <div class="sensor" id="light">
            <h2>Light Sensor</h2>
            <div class="status" id="data-light-serial">No USB device connected</div>
            <div class="controls">
                <button class="button" id="button-light-serial">Select USB Port</button>
            </div>
        </div>

        <div class="sensor" id="rotary">
            <h2>Rotary Encoder</h2>
            <div class="status" id="data-rotary-serial">No USB device connected</div>
            <div class="status" id="data-rotary-BLE">No Bluetooth device connected</div>
            <div class="controls">
                <button class="button" data-pair="button-rotary-BLE" id="button-rotary-serial">Select USB Port</button>
                <button class="button" data-pair="button-rotary-serial" id="button-rotary-BLE">Select Bluetooth Device</button>
            </div>
        </div>

        <div class="sensor" id="ultrasonic">
            <h2>Ultrasonic Sensor</h2>
            <div class="status" id="data-ultrasonic-serial">No USB device connected</div>
            <div class="status" id="data-ultrasonic-BLE">No Bluetooth device connected</div>
            <div class="controls">
                <button class="button" data-pair="button-ultrasonic-BLE" id="button-ultrasonic-serial">Select USB Port</button>
                <button class="button" data-pair="button-ultrasonic-serial" id="button-ultrasonic-BLE">Select Bluetooth Device</button>
            </div>
        </div>

        <hr>

    <h2>Live Sensor Charts</h2>
        <div class="controls">
            <button id="startButton">Start Recording</button>
            <button id="stopButton">Stop Recording</button>
            <button id="resetButton">Reset</button>
            <button id="toggleModeButton">Switch to Velocity</button>
            <button id="dualModeButton">Enable two charts</button>
            <button id="saveCsvButton">Save data (.csv)</button>
            <input type="file" id="importCsvInput" accept=".csv" style="display: none">
            <button id="importCsvButton">Import data (.csv)</button>
        </div>
        <div class="chart-container" id="angleChartContainer">
            <canvas id="sensorChartAngle" width="900" height="350"></canvas>
            <div class="controls">
                <button id="calculateDeltaAngle">Calculate Delta</button>
                <button id="calculateAreaAngle">Calculate Area</button>
            </div>
            <div class="status" id="calculationResultAngle"></div>
        </div>
        <div class="chart-container" id="velocityChartContainer" style="display: none;">
            <canvas id="sensorChartVelocity" width="900" height="350"></canvas>
            <div class="controls">
                <button id="calculateDeltaVelocity">Calculate Delta</button>
                <button id="calculateAreaVelocity">Calculate Area</button>
            </div>
            <div class="status" id="calculationResultVelocity"></div>
        </div>

    <script>
        function focusButton(event) {
            const clickedButton = event.target;
            const pairId = clickedButton.getAttribute('data-pair');
            const pairedButton = pairId ? document.getElementById(pairId) : null;

            if (pairedButton) {
                pairedButton.classList.add('hidden');
            }

            //hide the other sensors
            const currentSensor = clickedButton.closest('.sensor');
            if (currentSensor) {
                document.querySelectorAll('.sensor').forEach(section => {
                    if (section !== currentSensor) {
                        section.classList.add('hidden');
                    }
                });
            } else {
                console.error('Current sensor section not found');
            }

            // Set current sensor type
            if (clickedButton.id.includes('ultrasonic')) {
                window.currentSensor = 'ultrasonic';
            } else if (clickedButton.id.includes('rotary')) {
                window.currentSensor = 'rotary';
            } else {
                window.currentSensor = 'unknown';
            }

            // Update chart labels if function exists
            if (window.updateChartLabels) {
                window.updateChartLabels();
            }
        }

        //event listeners for the buttons
        document.querySelectorAll('.button').forEach(button => {
            button.addEventListener('click', focusButton);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="charting.js"></script>
    <script src="sensor-light.js"></script>
    <script type="module" src="sensor-rotary.js"></script>
    <script src="sensor-ultrasonic.js"></script>
    <script src="device-comms.js"></script>
</body>
</html>